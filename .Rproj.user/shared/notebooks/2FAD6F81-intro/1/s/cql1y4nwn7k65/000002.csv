"0","LRL<-function(x,y,lambda=1,epsilon=0.1){"
"0","  Sc<-function(B1,B0,a1){"
"0","    sc<-list()"
"0","    for (i in 1:4){"
"0","      sc<-c(sc,list(B1[[i]]+(a1-1)/a1*(B1[[i]]-B0[[i]])))"
"0","    }"
"0","    return(sc)"
"0","  }"
"0",""
"0","  Gradient<-function(x,y,S,i){"
"0","    n<-dim(x)[1]"
"0","    p<-matrix(0,64,64)"
"0","    for ( j in 1:n){"
"0","      p<-p+x[j,i]^2*S[[i]]-x[j,i]*(y[[j]]-x[j,1]*S[[1]]-x[j,2]*S[[2]]-x[j,3]*S[[3]]"
"0","                                   -x[j,4]*S[[4]]+x[j,i]*S[[i]])"
"0","    }"
"0","    p/n"
"0","  }"
"0","  QB<-function(B_hat,x,y,lambda=0){"
"0","    v<-list()"
"0","    n<-dim(x)[1]"
"0","    mse<-numeric(n)"
"0","    for (i in 1:n){"
"0","      a<-y[[i]]-x[i,1]*B_hat[[1]]-x[i,2]*B_hat[[2]]-x[i,3]*B_hat[[3]]-x[i,4]*B_hat[[4]]"
"0","      mse[i]<-sum(a^2)"
"0","    }"
"0","    v$MSE<-mean(mse)/2"
"0","    m<-length(B_hat)"
"0","    d<-numeric(m)"
"0","    for ( i in 1:m){"
"0","      d[i]<-sum(svd(B_hat[[i]])$d)"
"0","    }"
"0","    v$Bnorm<-lambda*sum(d)"
"0","    v$QB<- v$MSE+v$Bnorm"
"0","    v$norm<-sum(d)"
"0","    return(v)"
"0","  }"
"0","  delta<-length(y)/max(svd(t(x)%*%x)$d)"
"0","  B1<-B0<-list(matrix(0,64,64),matrix(0,64,64),"
"0","               matrix(0,64,64),matrix(0,64,64))"
"0","  a0<-0;a1<-1;C<-1"
"0","  while (isTRUE(C>epsilon)){"
"0","    S1<-Sc(B1,B0,a1)"
"0","    B0<-B1"
"0","    for (i in 1:4){"
"0","      A<-S1[[i]]-delta*Gradient(x,y,S1,i)"
"0","      sv<-svd(A)"
"0","      b<-sv$d-lambda*delta"
"0","      b<-(abs(b)+b)/2"
"0","      Bp<-sv$u%*%diag(b)%*%t(sv$v)"
"0","      B1[[i]]<-Bp"
"0","    }"
"0","    a1<-(1+sqrt(1+(2*a1)^2))/2"
"0","    C<-abs(QB(B1,x,y,lambda)$QB-QB(B0,x,y,lambda)$QB)"
"0",""
"0","  }"
"0","  return(B1)"
"0","}"
